version: '3'
services:
  postgres:
      image: postgres:alpine
      volumes:
          - ./init.sql:/docker-entrypoint-initdb.d/init.sql
      ports:
          - "5432:5432"
      environment:
          POSTGRES_PASSWORD: mypass

  go:
      build: ./docker/Go
      volumes:
          - .:/go/src/github.com/SemyonL95/social-tournament-service
      working_dir: /go/src/github.com/SemyonL95/social-tournament-service
      command: go run src/main.go
      links:
          - postgres:database
      ports:
          - "8080:8080"

  proxy:
      image: nginx:latest
      ports:
          - "80:80"
          - "443:443"
      volumes:
          - ./docker/Nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      links:
          - go:app
